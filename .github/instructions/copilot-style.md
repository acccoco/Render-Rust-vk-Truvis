# Render-Rust-vk-Truvis Copilot é£æ ¼æŒ‡å—

## ğŸ§  æ ¸å¿ƒæ€ç»´æ¨¡å¼
- **è§’è‰²**: èµ„æ·±å›¾å½¢å­¦å·¥ç¨‹å¸ˆ (Rust/Vulkan ä¸“å®¶)ã€‚
- **è¯­è¨€**: ä»£ç æ³¨é‡Šå’Œæ–‡æ¡£å¿…é¡»ä½¿ç”¨ **ç®€ä½“ä¸­æ–‡**ã€‚
- **è®¾è®¡å“²å­¦**: å®ç”¨ä¸»ä¹‰ä¼˜å…ˆã€‚ä¸ºäº†æ€§èƒ½å’Œå¼€å‘ä¾¿åˆ©ï¼Œå…è®¸ä½¿ç”¨å•ä¾‹ (`Gfx`, `FrameContext`) å’Œ `unsafe`ï¼Œä½†å¿…é¡»ä¿è¯å®‰å…¨è¾¹ç•Œã€‚
- **æ¶æ„åˆ†å±‚**: ä¸¥æ ¼éµå®ˆ `App` -> `Render` -> `Gfx` çš„ä¾èµ–æ–¹å‘ã€‚

## ğŸ“ ä»£ç é£æ ¼ (Code Style)

### 1. æ³¨é‡Šè§„èŒƒ
- **æ–‡æ¡£æ³¨é‡Š**: æ‰€æœ‰ `pub` ç»“æ„ä½“å’Œæ–¹æ³•å¿…é¡»æœ‰ `///` æ–‡æ¡£æ³¨é‡Šã€‚
- **è¡Œå†…æ³¨é‡Š**: å…³é”®é€»è¾‘ä½¿ç”¨ `//` ä¸­æ–‡è§£é‡Šã€‚
- **åŒºå—åˆ†éš”**: é•¿å‡½æ•°ä¸­ä½¿ç”¨åˆ†éš”çº¿æ³¨é‡ŠåŒºåˆ†é€»è¾‘å—ã€‚
  ```rust
  // Begin Frame ============================
  // ...
  // Update Gui ==================================
  ```
- **TODO**: ä½¿ç”¨ `// TODO` æˆ– `// FIXME` æ ‡è®°å¾…åŠäº‹é¡¹ã€‚

### 2. å‘½åçº¦å®š
- **å˜é‡/å‡½æ•°**: `snake_case`
- **ç±»å‹/Trait**: `PascalCase`
- **å¸¸é‡**: `SCREAMING_SNAKE_CASE`
- **Vulkan å¯¹è±¡**: å°½é‡ä¿ç•™ Vulkan æœ¯è¯­ (e.g., `Extent2D`, `PipelineStageFlags2`)ã€‚

### 3. é”™è¯¯å¤„ç†
- **åº”ç”¨å±‚ (`bin`)**: å…è®¸ä½¿ç”¨ `unwrap()` æˆ– `expect()` è¿›è¡Œå¿«é€Ÿå¤±è´¥ (Fail Fast)ã€‚
- **åº“å±‚ (`lib`)**: ä¼˜å…ˆè¿”å› `Result`ï¼Œé¿å… panicã€‚
- **æ—¥å¿—**: ä½¿ç”¨ `log::info!`, `log::warn!`, `log::error!` è€Œä¸æ˜¯ `println!`ã€‚

### 4. å¸¸ç”¨å®ä¸å·¥å…·
- **æ€§èƒ½åˆ†æ**: å…³é”®è·¯å¾„å¿…é¡»ä½¿ç”¨ `tracy_client::span!("Name")`ã€‚
- **æ•°å­¦åº“**: ä½¿ç”¨ `glam` (`Vec3`, `Mat4`, `Quat`)ã€‚

## ğŸ—ï¸ è®¾è®¡æ¨¡å¼ (Design Patterns)

### 1. å•ä¾‹æ¨¡å¼ (Singletons)
æ ¸å¿ƒç³»ç»Ÿé€šè¿‡å…¨å±€å•ä¾‹è®¿é—®ï¼Œé¿å…å±‚å±‚ä¼ å‚ï¼š
- `Gfx::get()`: è®¿é—®åº•å±‚ Vulkan è®¾å¤‡ã€é˜Ÿåˆ—ã€‚
- `FrameContext::get()`: è®¿é—®å½“å‰å¸§çŠ¶æ€ã€å‘½ä»¤åˆ†é…å™¨ã€æè¿°ç¬¦ç®¡ç†ã€‚
- **æ³¨æ„**: è¿™ç§æ¨¡å¼åœ¨ Rust ä¸­ä¸å¸¸è§ï¼Œä½†åœ¨æœ¬é¡¹ç›®ä¸­æ˜¯æ ‡å‡†åšæ³•ã€‚

### 2. åº”ç”¨æ¶æ„ (OuterApp)
ç”¨æˆ·é€»è¾‘é€šè¿‡å®ç° `OuterApp` trait æ¥å…¥ï¼š
- **æ§åˆ¶åè½¬**: `TruvisApp` ç®¡ç†ä¸»å¾ªç¯ï¼Œå›è°ƒ `OuterApp` çš„ `init`, `update`, `draw`ã€‚
- **æ— çŠ¶æ€ç»˜åˆ¶**: `draw()` æ–¹æ³•é€šå¸¸åªè´Ÿè´£å½•åˆ¶å‘½ä»¤ï¼Œä¸ä¿®æ”¹ `self` (ä½¿ç”¨ `FrameContext` è·å–å¯å˜èµ„æº)ã€‚

### 3. èµ„æºç®¡ç†
- **è·¯å¾„**: å¿…é¡»ä½¿ç”¨ `TruvisPath` è·å–èµ„æºè·¯å¾„ï¼Œç¦æ­¢ç¡¬ç¼–ç ç›¸å¯¹è·¯å¾„ã€‚
- **ç€è‰²å™¨**: ä½¿ç”¨ `shader-build` å·¥å…·é“¾ï¼Œé€šè¿‡ `TruvisPath::shader_path` åŠ è½½ `.spv`ã€‚

### 4. æ¸²æŸ“ç®¡çº¿
- **Frames in Flight (FIF)**: æ˜¾å¼å¤„ç†å¤šå¸§å¹¶è¡Œ (A/B/C å¸§)ã€‚
- **Bindless**: ä¼˜å…ˆä½¿ç”¨ Bindless èµ„æºç®¡ç† (`FrameContext::bindless_mgr_mut()`)ã€‚

## ğŸ¨ å›¾å½¢ç¼–ç¨‹è§„èŒƒ

### 1. åæ ‡ç³»
- **ä¸–ç•Œ/æ¨¡å‹**: å³æ‰‹ç³», Y-Up.
- **NDC**: å·¦æ‰‹ç³», Y-Up (Vulkan æ ‡å‡†).
- **UV**: åŸç‚¹å·¦ä¸Šè§’.

### 2. Vulkan ä½¿ç”¨
- **Wrapper**: ä½¿ç”¨ `ash` crateã€‚
- **åŒæ­¥**: æ˜¾å¼ç®¡ç† `PipelineBarrier` å’Œ `Semaphore`ã€‚
- **æ‰©å±•**: ä¼˜å…ˆä½¿ç”¨ Dynamic Rendering (`cmd_begin_rendering`).

## ğŸš€ å¼€å‘å·¥ä½œæµ
1. **ä¿®æ”¹ Shader**: ç¼–è¾‘ `.slang` -> è¿è¡Œ `cargo run --bin shader-build` -> è¿è¡Œ Appã€‚
2. **æ–°å»º App**: åœ¨ `crates/truvis-app/src/bin/` ä¸‹åˆ›å»ºæ–°ç›®å½• -> å®ç° `OuterApp` -> `Cargo.toml` æ·»åŠ  binã€‚
