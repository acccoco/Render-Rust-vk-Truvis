#pragma once

#include "share/__common.slangi"
#include "share/irradiance_cache_data.slangi"

namespace rt
{

#define RT_SET_NUM GLOBAL_SETS_COUNT

#ifdef __SLANG__

[[vk::binding(0, RT_SET_NUM)]]
RaytracingAccelerationStructure rt_tlas;

/// 单帧 RT 输出（每帧写入，用于后续累积）
[[vk::binding(1, RT_SET_NUM)]]
RWTexture2D<float4> rt_single_frame_output;

// ========== GBuffer Outputs ==========
/// GBufferA: normal.xyz + roughness (R16G16B16A16_SFLOAT)
[[vk::binding(2, RT_SET_NUM)]]
RWTexture2D<float4> gbuffer_a;

/// GBufferB: world_position.xyz + linear_depth (R16G16B16A16_SFLOAT)
[[vk::binding(3, RT_SET_NUM)]]
RWTexture2D<float4> gbuffer_b;

/// GBufferC: albedo.rgb + metallic (R8G8B8A8_UNORM)
[[vk::binding(4, RT_SET_NUM)]]
RWTexture2D<float4> gbuffer_c;

#endif

struct PushConstants
{
    PTR(ic::Table, ic_table);
    PTR(ic::EntryPool, ic_entry_pool);

    uint spp;
    uint spp_idx;
    uint channel;
    uint ic_enabled; // 0=禁用, 1=启用 Irradiance Cache
};
};
