# 全局对象

## RenderContext - 底层硬件管理

`RenderContext` 是渲染引擎的硬件接口层，管理所有 GPU 底层资源。

```rust
pub struct RenderContext {
    vk_core: VulkanCore,        // GPU 设备驱动
    allocator: MemAllocator,    // GPU 内存分配器
    temp_graphics_command_pool: CommandPool,  // 临时命令池
}
```

### 核心功能
- **设备管理**: 初始化 GPU 设备、队列、驱动
- **内存分配**: 统一管理所有 GPU 内存
- **命令系统**: 处理 CPU 到 GPU 的指令传递

### 使用方式
```rust
// 全局访问，随时可用
let ctx = RenderContext::get();
let gpu_memory = ctx.allocator.alloc_buffer(...);
```

---

## FrameContext - 每帧资源管理

`FrameContext` 管理每帧渲染所需的动态资源和状态。

```rust
pub struct FrameContext {
    frame_ctrl: Rc<FrameController>,        // 帧控制器 (A/B/C 循环)
    upload_buffer_mgr: RefCell<StageBufferManager>,  // 数据上传管理 (CPU→GPU)
    bindless_mgr: RefCell<BindlessManager>,          // 纹理资源管理
    cmd_allocator: RefCell<CmdAllocator>,           // 命令缓冲区分配
}
```

### Frame-in-Flight 机制

**三重缓冲流水线**:
```
帧 A: CPU 准备数据 | GPU 渲染 | 显示完成
帧 B: 显示完成    | CPU 准备数据 | GPU 渲染  
帧 C: GPU 渲染    | 显示完成    | CPU 准备数据
```

**优势**: CPU 和 GPU 并行工作，无需等待

### 核心组件

| 组件 | 功能 |
|------|------|
| **FrameController** | 帧标识管理，A/B/C 循环切换 |
| **StageBufferManager** | CPU→GPU 数据传输管理 |
| **BindlessManager** | 纹理资源统一访问管理 |
| **CmdAllocator** | GPU 命令缓冲区分配管理 |

### 使用方式
```rust
// 获取各种管理器
let mut cmd_alloc = FrameContext::cmd_allocator_mut();
let mut bindless = FrameContext::bindless_mgr_mut();

// 分配命令缓冲区
let cmd = cmd_alloc.alloc_command_buffer("render-pass");

// 注册纹理
bindless.register_texture("diffuse.png");
```

### 初始化顺序
```rust
RenderContext::init(...);     // 1. 初始化硬件层
FrameContext::init();         // 2. 初始化帧管理层
let renderer = Renderer::new(...); // 3. 创建渲染器
```